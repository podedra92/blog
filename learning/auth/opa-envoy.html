<!DOCTYPE html>
<html lang="en-UK" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OPA & Envoy | Dev Blog</title>
    <meta name="description" content="Prakashs Dev Blog">
    <link rel="preload stylesheet" href="/blog/assets/style.2d434bed.css" as="style">
    <script type="module" src="/blog/assets/app.353e6cd2.js"></script>
    <link rel="preload" href="/blog/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/blog/assets/chunks/framework.dab3cab5.js">
  <link rel="modulepreload" href="/blog/assets/chunks/theme.6deb76a0.js">
  <link rel="modulepreload" href="/blog/assets/learning_auth_opa-envoy.md.f5caba43.lean.js">
  <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-8LZFH8JKKD"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8LZFH8JKKD");</script>
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-abcc630f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-abcc630f data-v-0fa0e57d><div class="VPNavBar has-sidebar" data-v-0fa0e57d data-v-be450ad9><div class="container" data-v-be450ad9><div class="title" data-v-be450ad9><div class="VPNavBarTitle has-sidebar" data-v-be450ad9 data-v-6d2fb2d9><a class="title" href="/blog/" data-v-6d2fb2d9><!--[--><!--]--><!--[--><img class="VPImage logo" src="/blog/ninja-laptop.png" alt data-v-6db2186b><!--]--><!--[-->Useful<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-be450ad9><div class="curtain" data-v-be450ad9></div><div class="content-body" data-v-be450ad9><!--[--><!--]--><div class="VPNavBarSearch search" data-v-be450ad9><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><span class="DocSearch-Button-Key">Meta</span><span class="DocSearch-Button-Key">K</span></span></button></div></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-be450ad9 data-v-bdedfc22><span id="main-nav-aria-label" class="visually-hidden" data-v-bdedfc22>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/courses/" tabindex="0" data-v-bdedfc22 data-v-bbf845a0 data-v-a8b5c975><!--[-->Courses<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/learning/" tabindex="0" data-v-bdedfc22 data-v-bbf845a0 data-v-a8b5c975><!--[-->Learnings<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/about/" tabindex="0" data-v-bdedfc22 data-v-bbf845a0 data-v-a8b5c975><!--[-->About Me<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-be450ad9 data-v-da3f667a><label title="toggle dark mode" data-v-da3f667a data-v-2eaa5496><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-2eaa5496 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-2eaa5496><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-2eaa5496><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-be450ad9 data-v-2ab2a029 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://uk.linkedin.com/in/prakash-odedra-892183183" aria-label="linkedin" target="_blank" rel="noopener" data-v-f6988cfb data-v-92b28dff><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a><a class="VPSocialLink" href="https://github.com/podedra92" aria-label="github" target="_blank" rel="noopener" data-v-f6988cfb data-v-92b28dff><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-be450ad9 data-v-66bb1f24 data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-96001b6b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-96001b6b><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-66bb1f24><div class="item appearance" data-v-66bb1f24><p class="label" data-v-66bb1f24>Appearance</p><div class="appearance-action" data-v-66bb1f24><label title="toggle dark mode" data-v-66bb1f24 data-v-2eaa5496><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-2eaa5496 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-2eaa5496><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-2eaa5496><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><div class="group" data-v-66bb1f24><div class="item social-links" data-v-66bb1f24><div class="VPSocialLinks social-links-list" data-v-66bb1f24 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://uk.linkedin.com/in/prakash-odedra-892183183" aria-label="linkedin" target="_blank" rel="noopener" data-v-f6988cfb data-v-92b28dff><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a><a class="VPSocialLink" href="https://github.com/podedra92" aria-label="github" target="_blank" rel="noopener" data-v-f6988cfb data-v-92b28dff><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-be450ad9 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-abcc630f data-v-2dcb6fa6><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2dcb6fa6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-2dcb6fa6><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-2dcb6fa6>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2dcb6fa6 data-v-ab3c7793><button class="" data-v-ab3c7793>Contents <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-ab3c7793><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></button><!----></div></div><aside class="VPSidebar" data-v-abcc630f data-v-c79ccefa><div class="curtain" data-v-c79ccefa></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-c79ccefa><span class="visually-hidden" id="sidebar-aria-label" data-v-c79ccefa> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0" data-v-c79ccefa data-v-5d3c8d52><div class="item" role="button" tabindex="0" data-v-5d3c8d52><div class="indicator" data-v-5d3c8d52></div><h2 class="text" data-v-5d3c8d52>Introduction</h2><!----></div><div class="items" data-v-5d3c8d52><!--[--><div class="VPSidebarItem level-1 is-link" data-v-5d3c8d52 data-v-5d3c8d52><div class="item" data-v-5d3c8d52><div class="indicator" data-v-5d3c8d52></div><a class="VPLink link link" href="/blog/learning/" data-v-5d3c8d52 data-v-a8b5c975><!--[--><p class="text" data-v-5d3c8d52>Recent Posts</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c79ccefa data-v-5d3c8d52><div class="item" role="button" tabindex="0" data-v-5d3c8d52><div class="indicator" data-v-5d3c8d52></div><h2 class="text" data-v-5d3c8d52>Documentation</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-5d3c8d52><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-5d3c8d52><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-5d3c8d52><!--[--><div class="VPSidebarItem level-1 is-link" data-v-5d3c8d52 data-v-5d3c8d52><div class="item" data-v-5d3c8d52><div class="indicator" data-v-5d3c8d52></div><a class="VPLink link link" href="/blog/learning/docs/this-blog" data-v-5d3c8d52 data-v-a8b5c975><!--[--><p class="text" data-v-5d3c8d52>How this blog was made</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-5d3c8d52 data-v-5d3c8d52><div class="item" data-v-5d3c8d52><div class="indicator" data-v-5d3c8d52></div><a class="VPLink link link" href="/blog/learning/docs/my-docs" data-v-5d3c8d52 data-v-a8b5c975><!--[--><p class="text" data-v-5d3c8d52>Tips on Writing</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0 collapsible has-active" data-v-c79ccefa data-v-5d3c8d52><div class="item" role="button" tabindex="0" data-v-5d3c8d52><div class="indicator" data-v-5d3c8d52></div><h2 class="text" data-v-5d3c8d52>Auth</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-5d3c8d52><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-5d3c8d52><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-5d3c8d52><!--[--><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-5d3c8d52 data-v-5d3c8d52><div class="item" data-v-5d3c8d52><div class="indicator" data-v-5d3c8d52></div><a class="VPLink link link" href="/blog/learning/auth/opa-envoy" data-v-5d3c8d52 data-v-a8b5c975><!--[--><p class="text" data-v-5d3c8d52>OPA & Envoy</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-5d3c8d52 data-v-5d3c8d52><div class="item" data-v-5d3c8d52><div class="indicator" data-v-5d3c8d52></div><a class="VPLink link link" href="/blog/learning/auth/opa-envoy-pt2" data-v-5d3c8d52 data-v-a8b5c975><!--[--><p class="text" data-v-5d3c8d52>OPA & Envoy pt2.</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-abcc630f data-v-fe5dac9b><div class="VPDoc has-sidebar has-aside" data-v-fe5dac9b data-v-e76d1fb6><div class="container" data-v-e76d1fb6><div class="aside" data-v-e76d1fb6><div class="aside-curtain" data-v-e76d1fb6></div><div class="aside-container" data-v-e76d1fb6><div class="aside-content" data-v-e76d1fb6><div class="VPDocAside" data-v-e76d1fb6 data-v-cdc66372><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-cdc66372 data-v-7f4425f6><div class="content" data-v-7f4425f6><div class="outline-marker" data-v-7f4425f6></div><div class="outline-title" data-v-7f4425f6>Contents</div><nav aria-labelledby="doc-outline-aria-label" data-v-7f4425f6><span class="visually-hidden" id="doc-outline-aria-label" data-v-7f4425f6> Table of Contents for current page </span><ul class="root" data-v-7f4425f6 data-v-e82ceacd><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cdc66372></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e76d1fb6><div class="content-container" data-v-e76d1fb6><!--[--><!--]--><div class="VPDocOutlineDropdown" data-v-e76d1fb6 data-v-1c313eb9><button class="" data-v-1c313eb9>Contents <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-1c313eb9><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></button><!----></div><main class="main" data-v-e76d1fb6><div style="position:relative;" class="vp-doc _blog_learning_auth_opa-envoy" data-v-e76d1fb6><div><h1 id="authn-authz-using-opa-envoy" tabindex="-1">Authn &amp; Authz using OPA &amp; Envoy <a class="header-anchor" href="#authn-authz-using-opa-envoy" aria-label="Permalink to &quot;Authn &amp; Authz using OPA &amp; Envoy&quot;">​</a></h1><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">​</a></h2><p>So I recently played with OPA &amp; Envoy in-order to explore authentication (Authn) and authorization (Authz).<br> In this blog, we&#39;ll look to quickly walk through the setup, and to accompany this post there is an example <a href="https://github.com/podedra92/opa-envoy" target="_blank" rel="noreferrer">opa-envoy repo found here</a>.</p><p>Worth noting if you&#39;re using Open Service Mesh - they have a walkthrough for enabling the plugin, <a href="https://release-v1-2.docs.openservicemesh.io/docs/guides/integrations/external_auth_opa/#osm-with-opa-plugin-external-authorization-walkthrough" target="_blank" rel="noreferrer">ref doc</a>.</p><p><strong>Note:</strong> There are a tonne of other approaches to auth - so further posts will also probably follow.</p><h3 id="authn-authz" tabindex="-1">Authn &amp; Authz <a class="header-anchor" href="#authn-authz" aria-label="Permalink to &quot;Authn &amp; Authz&quot;">​</a></h3><p>Lets cover the basics:</p><p><strong>Authn:</strong> Verifies the identity of a user or system, I am who I say I am, e.g. credential based (username and password), certificate based etc.</p><p><strong>Authz:</strong> Determines whether a user or a system is authorized to access a resource or perform an action. This involves evaluating the permissions/entitlements granted to the user or the system, against a set of policies which specify what is allowed or denied.</p><h3 id="why-are-we-doing-this" tabindex="-1">Why are we doing this? <a class="header-anchor" href="#why-are-we-doing-this" aria-label="Permalink to &quot;Why are we doing this?&quot;">​</a></h3><p>We could embed this within our application, but really we want to try decouple the security concerns from business logic.<br> SoC (separation of concerns) leads to easier updates and testing, having said this we still want to enable our various development teams by allowing them to write their own policies, but have it centrally managed.</p><h3 id="opa" tabindex="-1">OPA <a class="header-anchor" href="#opa" aria-label="Permalink to &quot;OPA&quot;">​</a></h3><p>Open Policy Agent (OPA) if you aren&#39;t already aware is a well established CNCF graduate, having been accepted in 2018.<br> Its an open source, versatile policy engine, providing a central and unified method for enforcing policies.</p><p>Rego is the declarative language used for defining fine-grained policies, its meant to be easy to read and write (perfect for me!).<br> Once policies are authored and tested, they are consumed by OPA and used for evaluation.</p><h3 id="envoy" tabindex="-1">Envoy <a class="header-anchor" href="#envoy" aria-label="Permalink to &quot;Envoy&quot;">​</a></h3><p>Envoy is a proxy operating at L7 level, its the backbone for most service meshes, and fortunately for us supports External filters, such as an external authorization filter, this allows for delegation of decisions such as authorization to an external service.</p><p>This is where OPA and Envoy can be used in conjunction, OPA-Envoy plugin extends OPA with a gRPC server which implements Envoys External authz api (authorization filter).</p><h2 id="implement" tabindex="-1">Implement <a class="header-anchor" href="#implement" aria-label="Permalink to &quot;Implement&quot;">​</a></h2><p>Lets have a look at what we&#39;re creating:</p><p><img src="/blog/assets/opa-envoy-c4.6579884e.png" alt="design"></p><ol><li><p>I&#39;ll use credentials to retrieve a token from Azure AD (Active Directory).</p></li><li><p>The token retrieved in step 1 will then be passed, in the header of my request, to the api. Envoy acting as a proxy will look to carry out the authn and authz filters.</p></li><li><p>Authn filter will validate the JWT, an invalid token will return a 401, a valid token will be forwarded on.</p></li><li><p>Envoy will then initiate the Authz filter, offloading the decision to OPA, the authorization service.<br> OPA will validate the role within the token against the policies defined and determine whether the action should be permitted or denied.</p></li><li><p>Envoy then forwards the request to the service or returns a 403 (forbidden).</p></li></ol><div class="tip custom-block"><p class="custom-block-title">Deploying</p><p>When not running locally, we&#39;ll probably want to deploy the services as sidecar containers.</p></div><hr><h3 id="create-app-registrations-azure-ad" tabindex="-1">Create App Registrations - Azure AD <a class="header-anchor" href="#create-app-registrations-azure-ad" aria-label="Permalink to &quot;Create App Registrations - Azure AD&quot;">​</a></h3><p><strong>Note:</strong> You can also use the same steps within Azure AD B2C.</p><ol><li>Create an app registration - <a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app#register-an-application" target="_blank" rel="noreferrer">see microsoft docs</a></li></ol><p><strong>Azure Active Directory &gt; App registrations &gt; + New Registration</strong></p><p><img src="/blog/assets/azuread-newappregistration-1.f301672d.png" alt="new-registration"></p><hr><hr> Select Register - don&#39;t set redirect URI <p><img src="/blog/assets/azuread-newappregistration-2.dcf9ae99.png" alt="new-registration1"></p><hr><hr><p>After registering:</p><ol><li><p>Note the Application ID <img src="/blog/assets/azuread-newappregistration-clientid.0f4434ba.png" alt="new-registration1"></p></li><li><p>Add a client secret <img src="/blog/assets/azuread-newappregistration-3.90e170b0.png" alt="new-registration1"></p></li><li><p>Enforce the use of the V2 OAuth endpoint - see this blog for more info <a href="https://matthijs.hoekstraonline.net/2020/04/27/v1-and-v2-identity-and-access-tokens-with-azure-active-directory/" target="_blank" rel="noreferrer">V1 &amp; V2 Access tokens.</a><img src="/blog/assets/azuread-newappregistration-4.e7e67529.png" alt="new-registration1"></p></li><li><p>Set App ID URI</p></li></ol><p><img src="/blog/assets/azuread-newappregistration-5.d053cbbb.png" alt="new-registration1"></p><hr><hr><p>Now we want to create a few custom app roles, I&#39;m going to create one role called team1, and a second role team2.</p><p><img src="/blog/assets/azuread-newappregistration-approle.99f9a600.png" alt="new-registration1"></p><br><hr><hr><p>Ok so we&#39;ve created our first app registration for the application, what we want to do now is create an app registration for each of our teams I&#39;ll name these apps <strong>team-1</strong> &amp; <strong>team-2</strong>. <br><br> So we&#39;ll only need to repeat a couple of our steps from above:</p><ol><li>Register a new app.</li><li>Add client secret to the app.</li></ol><p>We now want to delegate an API permission from my <strong>team-1</strong> app registration to <strong>my-demo-app</strong> app registration, giving it the role, you guessed it, <strong>team1</strong>.<br> We&#39;ll also do the same for my <strong>team-2</strong> app, why?<br> Well this will allow us to obtain a token, using the credentials from my <strong>team-1</strong> or <strong>team-2</strong> app registration, with the appropriate scope to <strong>my-demo-app</strong>.</p><ol><li><p>Add the api permission for my-demo-app from my <strong>team-1</strong> app <img src="/blog/assets/azuread-newappregistration-apiperm-1.9e185bd3.png" alt="new-registration1"><br></p></li><li><p>Add the <strong>team1</strong> app role <img src="/blog/assets/azuread-newappregistration-apiperm-2.4a137595.png" alt="new-registration1"><br></p></li><li><p>Grant admin consent - this consents to the configuration made to the application <img src="/blog/assets/azuread-newappregistration-apiperm-3.1162fe9e.png" alt="new-registration1"></p></li></ol><br> We&#39;ll then do the same to our **team-2** app.<br><p><strong>Now to test it!</strong></p><p>So we&#39;ll need to retrieve a token by making a POST request to the OAuth V2 endpoint, but using our <strong>team-1</strong> and <strong>team-2</strong> credentials.</p><ol><li><p>Head over to the my-demo-app overview, select endpoints and copy the V2 token endpoint: <img src="/blog/assets/azuread-appregistration-v2tokenendpoint.afabfa8f.png" alt="new-registration1"><br></p></li><li><p>We need the scope, as we&#39;ll be using the <code>grant_type: client_credentials</code>, we&#39;ll use the ./default scope so using the client id of <strong>my-demo-app</strong> we can define populate the scope, <code>scope: api://&lt;client-id&gt;/.default</code>.<br> To see more on scopes with Azure AD check out <a href="https://dev.to/425show/just-what-is-the-default-scope-in-the-microsoft-identity-platform-azure-ad-2o4d" target="_blank" rel="noreferrer">this blog here</a>. <br></p></li><li><p>Now we just need the client_id and secret for our team apps, so take a note of the credentials for <code>team-1</code> and <code>team-2</code></p></li></ol><p><img src="/blog/assets/azuread-appid.a5de0064.png" alt="new-registration1"></p><p><br><br></p><p><img src="/blog/assets/azuread-secret.a84b0eac.png" alt="new-registration1"></p><hr><p><strong>Finally</strong> - Lets make a POST request - I&#39;m going to use postman here, and the credentials from my team-1 app:</p><p><img src="/blog/assets/postman-req-token.b7a8b3a1.png" alt="new-registration1"></p><p>Hey presto!<br> We have our token - if we head over to <a href="https://jwt.io/" target="_blank" rel="noreferrer">jwt.io</a> to decode our bearer token:</p><p>Note the role - <strong>team1</strong> (We&#39;d also get the <strong>team2</strong>, role using my <strong>team-2</strong> app credentials instead).</p><p><img src="/blog/assets/decoded-token.73814ccc.png" alt="new-registration1"></p><hr><hr><h3 id="that-was-fun-but-i-need-a-quick-break" tabindex="-1">That was fun - but I need a quick break.. <a class="header-anchor" href="#that-was-fun-but-i-need-a-quick-break" aria-label="Permalink to &quot;That was fun - but I need a quick break..&quot;">​</a></h3><p><img src="/blog/assets/coffee.10760fe2.gif" alt="coffee"></p><p><a href="./opa-envoy-pt2">Once you&#39;ve grabbed your coffee, feel free to continue here...</a></p></div></div></main><footer class="VPDocFooter" data-v-e76d1fb6 data-v-7246529b><!--[--><!--]--><div class="edit-info" data-v-7246529b><div class="edit-link" data-v-7246529b><a class="VPLink link edit-link-button" href="https://github.com/podedra92/blog" target="_blank" rel="noreferrer" data-v-7246529b data-v-a8b5c975><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-7246529b><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> Edit this page on GitHub<!--]--><!----></a></div><!----></div><div class="prev-next" data-v-7246529b><div class="pager" data-v-7246529b><a class="pager-link prev" href="/blog/learning/docs/my-docs" data-v-7246529b><span class="desc" data-v-7246529b>Previous page</span><span class="title" data-v-7246529b>Tips on Writing</span></a></div><div class="has-prev pager" data-v-7246529b><a class="pager-link next" href="/blog/learning/auth/opa-envoy-pt2" data-v-7246529b><span class="desc" data-v-7246529b>Next page</span><span class="title" data-v-7246529b>OPA & Envoy pt2.</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-abcc630f data-v-d24360a6><div class="container" data-v-d24360a6><!----><p class="copyright" data-v-d24360a6>© 2022 Prakash Odedra</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"courses_cicd_gitlab_1-intro.md\":\"ddca429b\",\"courses_cicd_index.md\":\"a138fea5\",\"courses_iac_good-practices.md\":\"28c64d17\",\"courses_iac_pulumi-vs-terraform.md\":\"7e418b4a\",\"courses_iac_index.md\":\"9d969efa\",\"index.md\":\"d1d6fa78\",\"courses_iac_pulumi_1-intro.md\":\"2e08288e\",\"about_index.md\":\"ba2d6fac\",\"learning_docs_my-docs.md\":\"01a1475d\",\"learning_docs_this-blog.md\":\"8ad7f3cd\",\"learning_index.md\":\"21240773\",\"courses_index.md\":\"c105e143\",\"learning_auth_opa-envoy-pt2.md\":\"2b445607\",\"learning_auth_opa-envoy.md\":\"f5caba43\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-UK\",\"dir\":\"ltr\",\"title\":\"Useful\",\"titleTemplate\":\"Dev Blog\",\"description\":\"Prakashs Dev Blog\",\"base\":\"/blog/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"outlineTitle\":\"Contents\",\"logo\":\"/ninja-laptop.png\",\"socialLinks\":[{\"icon\":\"linkedin\",\"link\":\"https://uk.linkedin.com/in/prakash-odedra-892183183\"},{\"icon\":\"github\",\"link\":\"https://github.com/podedra92\"}],\"nav\":[{\"text\":\"Courses\",\"link\":\"/courses/\"},{\"text\":\"Learnings\",\"link\":\"/learning/\"},{\"text\":\"About Me\",\"link\":\"/about/\"}],\"footer\":{\"copyright\":\"© 2022 Prakash Odedra\"},\"editLink\":{\"pattern\":\"https://github.com/podedra92/blog\",\"text\":\"Edit this page on GitHub\"},\"sidebar\":{\"/learning/\":[{\"text\":\"Introduction\",\"items\":[{\"text\":\"Recent Posts\",\"link\":\"/learning/\"}]},{\"text\":\"Documentation\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"How this blog was made\",\"link\":\"/learning/docs/this-blog\"},{\"text\":\"Tips on Writing\",\"link\":\"/learning/docs/my-docs\"}]},{\"text\":\"Auth\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"OPA & Envoy\",\"link\":\"/learning/auth/opa-envoy.md\"},{\"text\":\"OPA & Envoy pt2.\",\"link\":\"/learning/auth/opa-envoy-pt2.md\"}]}],\"/courses/\":[{\"items\":[{\"text\":\"Introduction\",\"link\":\"/courses/\"}]},{\"text\":\"Infrastructure As Code\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Intro\",\"link\":\"/courses/IAC/\"}]}]}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":true}")</script>
    
  </body>
</html>